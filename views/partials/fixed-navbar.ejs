<!-- views/partials/fixed-navbar.ejs - แก้ไขปัญหาการแสดงผลบนมือถือ -->
<header class="bg-teal">
    <div class="container-fluid">
      <div class="row py-2 border-bottom align-items-center">
        
        <!-- Logo & Toggle Button - ปรับปรุงโครงสร้างสำหรับมือถือ -->
        <div class="col-auto col-md-3 d-flex align-items-center">
          <!-- Logo ที่ปรับขนาดตามจอ -->
          <a href="/" class="navbar-brand">
            <h2 class="text-light m-0"><i class="fa-solid fa-heart-pulse"></i> R.P.C</h2>
          </a>
          
          <!-- ปุ่มค้นหาบนมือถือ (แสดงเฉพาะบนมือถือ) -->
          <button class="btn text-light d-lg-none ms-2" type="button" 
                  data-bs-toggle="collapse" data-bs-target="#mobileSearchCollapse" 
                  aria-expanded="false" aria-controls="mobileSearchCollapse">
            <i class="fas fa-search"></i>
          </button>
        </div>
        
        <!-- ส่วนเมนูด้านขวา -->
        <div class="col d-flex justify-content-end">
          <!-- เมนูบนเดสก์ท็อป - ซ่อนบนมือถือ -->
          <ul class="navbar-nav d-none d-lg-flex flex-row align-items-center gap-4 me-3">
            <li class="nav-item">
              <a href="/" class="nav-link text-light">home</a>
            </li>
            <li class="nav-item dropdown">
              <a class="nav-link text-light dropdown-toggle" href="#" role="button" 
                 data-bs-toggle="dropdown" aria-expanded="false">หมวดหมู่</a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="/shop">ดูทั้งหมด</a></li>
                <% if (locals.categories && categories.length > 0) { %>
                  <% categories.forEach(category => { %>
                    <li><a class="dropdown-item" href="/shop/category/<%= category.id %>"><%= category.name %></a></li>
                  <% }); %>
                <% } %>
              </ul>
            </li>
            <li class="nav-item">
              <a href="/shop/products" class="nav-link text-light">สินค้าทั้งหมด</a>
            </li>
            <li class="nav-item">
              <a href="/about-us" class="nav-link text-light">เกี่ยวกับเรา</a>
            </li>
          </ul>
          
          <!-- ปุ่มเข้าสู่ระบบ / แอดมิน -->
          <div class="d-flex align-items-center">
            <% if (locals.isLoggedIn) { %>
              <div class="dropdown">
                <a href="#" class="text-light dropdown-toggle" id="adminDropdown" 
                   data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="fa-solid fa-user-tie"></i>
                  <span class="d-none d-md-inline ms-1">แอดมิน</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="adminDropdown">
                  <li><a class="dropdown-item" href="/categories"><i class="fa-solid fa-list me-2"></i>จัดการหมวดหมู่</a></li>
                  <li><a class="dropdown-item" href="/products"><i class="fa-solid fa-box me-2"></i>จัดการสินค้า</a></li>
                  <li><a class="dropdown-item" href="/users/list"><i class="fa-solid fa-users me-2"></i>จัดการผู้ใช้</a></li>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <a class="dropdown-item" href="/logout" onclick="return confirm('คุณต้องการออกจากระบบหรือไม่?')">
                      <i class="fa-solid fa-right-from-bracket me-2"></i>ออกจากระบบ
                    </a>
                  </li>
                </ul>
              </div>
            <% } else { %>
              <a href="/login" class="text-light">
                <i class="fa-solid fa-right-to-bracket"></i>
                <span class="d-none d-md-inline ms-1">เข้าสู่ระบบ</span>
              </a>
            <% } %>
            
            <!-- ปุ่มเปิดเมนูบนมือถือ -->
            <button class="navbar-toggler text-light ms-3 d-lg-none border-0" type="button" 
                    data-bs-toggle="offcanvas" data-bs-target="#mobileNavOffcanvas" 
                    aria-controls="mobileNavOffcanvas">
              <i class="fas fa-bars"></i>
            </button>
          </div>
        </div>
      </div>
      
      <!-- ช่องค้นหาบนมือถือ - แสดงเฉพาะเวลากดปุ่ม -->
      <div class="collapse w-100 py-2" id="mobileSearchCollapse">
        <form action="/shop/search" method="get">
          <div class="input-group">
            <input type="text" class="form-control" name="q" placeholder="Search for products..."
                  aria-label="Search products">
            <button class="btn btn-light" type="submit">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </form>
      </div>
      
      <!-- ช่องค้นหาบนเดสก์ท็อป - แสดงเฉพาะบนจอใหญ่ -->
      <div class="py-2 d-none d-lg-block">
        <form action="/shop/search" method="get" class="mx-auto" style="max-width: 600px;">
          <div class="input-group">
            <input type="text" class="form-control rounded-start" name="q" 
                  placeholder="Search for products..." aria-label="Search products">
            <button class="btn btn-light rounded-end" type="submit">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </form>
      </div>
    </div>
  </header>
  
  <!-- เมนูด้านข้างบนมือถือ -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="mobileNavOffcanvas" 
       aria-labelledby="mobileNavOffcanvasLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="mobileNavOffcanvasLabel">MENU</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body p-0">
      <!-- เมนูหลัก -->
      <div class="list-group list-group-flush">
        <a href="/" class="list-group-item list-group-item-action">
          <i class="fa-solid fa-home me-2"></i> home
        </a>
        <a href="/shop" class="list-group-item list-group-item-action">
          <i class="fa-solid fa-store me-2"></i> หมวดหมู่สินค้า
        </a>
        <a href="/shop/products" class="list-group-item list-group-item-action">
          <i class="fa-solid fa-box me-2"></i> สินค้าทั้งหมด
        </a>
        <a href="/about-us" class="list-group-item list-group-item-action">
          <i class="fa-solid fa-info-circle me-2"></i> เกี่ยวกับเรา
        </a>
        
        <% if (locals.isLoggedIn) { %>
          <a href="/logout" class="list-group-item list-group-item-action text-danger"
             onclick="return confirm('คุณต้องการออกจากระบบหรือไม่?')">
            <i class="fa-solid fa-right-from-bracket me-2"></i> ออกจากระบบ
          </a>
        <% } else { %>
          <a href="/login" class="list-group-item list-group-item-action">
            <i class="fa-solid fa-right-to-bracket me-2"></i> เข้าสู่ระบบ
          </a>
        <% } %>
      </div>
      
      <!-- รายการหมวดหมู่ -->
      <div class="mt-3 p-3">
        <h6 class="fw-bold border-bottom pb-2">หมวดหมู่สินค้า</h6>
        <div class="list-group list-group-flush">
          <% if (locals.categories && categories.length > 0) { %>
            <% categories.forEach(category => { %>
              <a href="/shop/category/<%= category.id %>" class="list-group-item list-group-item-action border-0 py-2">
                <i class="fa-solid fa-tag me-2 text-secondary"></i> <%= category.name %>
              </a>
            <% }); %>
          <% } else { %>
            <p class="text-muted small">ไม่มีหมวดหมู่</p>
          <% } %>
        </div>
      </div>
      
      <!-- เมนูแอดมิน (ถ้าล็อกอิน) -->
      <% if (locals.isLoggedIn) { %>
        <div class="mt-3 p-3">
          <h6 class="fw-bold border-bottom pb-2">แผงควบคุมแอดมิน</h6>
          <div class="list-group list-group-flush">
            <a href="/categories" class="list-group-item list-group-item-action border-0 py-2">
              <i class="fa-solid fa-list me-2 text-primary"></i> จัดการหมวดหมู่
            </a>
            <a href="/products" class="list-group-item list-group-item-action border-0 py-2">
              <i class="fa-solid fa-box me-2 text-success"></i> จัดการสินค้า
            </a>
            <a href="/users/list" class="list-group-item list-group-item-action border-0 py-2">
              <i class="fa-solid fa-users me-2 text-info"></i> จัดการผู้ใช้
            </a>
          </div>
        </div>
      <% } %>
    </div>
  </div>