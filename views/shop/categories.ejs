<!-- Updated views/shop/categories.ejs with better mobile responsiveness -->
<div id="carouselExampleIndicators" class="carousel slide mb-4" data-bs-ride="carousel">
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
  </div>
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="/images/Carousel1.png" class="d-block w-100" alt="Promotion slide 1">
    </div>
    <div class="carousel-item">
      <img src="/images/Carousel2.png" class="d-block w-100" alt="Promotion slide 2">
    </div>
    <div class="carousel-item">
      <img src="/images/Carousel3.png" class="d-block w-100" alt="Promotion slide 3">
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>

<div class="container my-4">

  <%- include('../partials/breadcrumb', { 
    items: [
      { name: 'หน้าแรก', url: '/', icon: 'fa-solid fa-home' },
      { name: 'หมวดหมู่สินค้า', active: true, icon: 'fa-solid fa-tags' }
    ],
    style: 'modern' // เลือก: 'classic', 'modern', 'minimal', 'gradient', 'accent'
  }) %>

  <h1 class="mb-4 text-dark fs-2">หมวดหมู่สินค้า</h1>
  
  <div class="row">
    <div class="col-md-12">
      <% if (categories && categories.length > 0) { %>
        <!-- Start of Category Grid with Improved Cards -->
        <div class="category-grid row row-cols-2 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-3">
          <% categories.forEach(category => { %>
            <div class="col">
              <a href="/shop/category/<%= category.id %>" class="text-decoration-none">
                <div class="category-card">
                  <div class="category-img-container">
                    <% if (category.image) { %>
                      <img src="<%= category.image %>" alt="<%= category.name %>" class="category-img" loading="lazy">
                    <% } else { %>
                      <div class="d-flex justify-content-center align-items-center h-100">
                        <i class="bi bi-collection text-muted" style="font-size: 2.5rem;"></i>
                      </div>
                    <% } %>
                  </div>
                  
                  <div class="category-info">
                    <h3 class="category-title"><%= category.name %></h3>
                    <% 
                      // Display product count
                      let productCount = 0;
                      if (category.productCount !== undefined) {
                        productCount = category.productCount;
                      } else if (Array.isArray(category.products)) {
                        productCount = category.products.length;
                      }
                    %>
                    <div class="category-count">
                      <i class="bi bi-box me-1"></i>
                      <%= productCount %> รายการ
                    </div>
                  </div>
                </div>
              </a>
            </div>
          <% }) %>
        </div>
        <!-- End of Category Grid -->
      <% } else { %>
        <div class="col-12 text-center py-5">
          <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            ยังไม่มีหมวดหมู่สินค้าในระบบ
          </div>
        </div>
      <% } %>
    </div>
  </div>
  
  <div class="text-center mt-5 mb-5">
    <a href="/shop/products" class="btn btn-outline-dark">
      <i class="bi bi-grid me-2"></i>
      ดูสินค้าทั้งหมด
    </a>
  </div>
</div>

<style>
  /* Category Card Styles */
  .category-card {
    border-radius: 8px;
    border: 1px solid rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    height: 100%;
    display: flex;
    flex-direction: column;
    background-color: #fff;
    overflow: hidden;
  }
  
  .category-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
  }
  
  /* Image container */
  .category-img-container {
    position: relative;
    padding-top: 75%; /* 4:3 Aspect Ratio */
    overflow: hidden;
    background-color: #f8f9fa;
  }
  
  .category-img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: contain;
    padding: 16px;
    transition: transform 0.3s ease;
  }
  
  .category-card:hover .category-img {
    transform: scale(1.05);
  }
  
  /* Category info */
  .category-info {
    padding: 16px;
    text-align: center;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: #f8f9fa;
  }
  
  .category-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 8px;
    color: #212529;
    display: -webkit-box;
    -webkit-line-clamp: 1;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    width: 100%;
  }
  
  .category-count {
    color: #6c757d;
    font-size: 13px;
  }
  
  /* Carousel adjustments for mobile */
  @media (max-width: 768px) {
    .carousel-item img {
      height: 150px;
      object-fit: cover;
    }
    
    h1 {
      font-size: 1.5rem !important;
    }
  }
  
  /* Category card adjustments for mobile */
  @media (max-width: 576px) {
    .category-img-container {
      padding-top: 80%; /* Slightly taller for mobile */
    }
    
    .category-info {
      padding: 10px;
    }
    
    .category-title {
      font-size: 14px;
      margin-bottom: 4px;
    }
    
    .category-count {
      font-size: 12px;
    }
    
    /* Improve grid layout on very small screens */
    .g-3 {
      --bs-gutter-x: 0.75rem;
    }
    
    .container {
      padding-left: 10px;
      padding-right: 10px;
    }
    
    .breadcrumb {
      font-size: 0.8rem;
    }
    
    .breadcrumb-item+.breadcrumb-item::before {
      padding-right: 0.3rem;
      padding-left: 0.3rem;
    }
  }
  
  /* Further optimizations for very small screens */
  @media (max-width: 375px) {
    .category-title {
      font-size: 13px;
    }
    
    .category-count {
      font-size: 11px;
    }
    
    .category-img {
      padding: 12px;
    }
  }
</style>