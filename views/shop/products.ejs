<!-- views/shop/products.ejs -->
<div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
  </div>
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="/images/Carousel1.png" class="d-block w-100" alt="...">
    </div>
    <div class="carousel-item">
      <img src="/images/Carousel2.png" class="d-block w-100" alt="...">
    </div>
    <div class="carousel-item">
      <img src="/images/Carousel3.png" class="d-block w-100" alt="...">
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>

<div class="container my-5">
  <h4 aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item text-dark"><a class="a" href="/">หน้าแรก</a></li>
      <li class="breadcrumb-item active" aria-current="page"><%= category.name %></li>
    </ol>
  </h4>
  
  <h1 class="mb-4 text-dark"><%= category.name %></h1>
  
  <div class="row">
    <div class="col-md-12">
      <% if (products && products.length > 0) { %>
        <div class="product-grid row row-cols-2 row-cols-sm-2 row-cols-md-3 row-cols-lg-3 row-cols-xl-4 row-cols-xxl-5">
          <% products.forEach(product => { %>
            <div class="col mb-4">
              <div class="product-item h-100 border shadow-sm rounded">
                <a href="/shop/product/<%= product.id %>" title="<%= product.name %>" class="a">
                  <figure class="m-0 p-3 text-center">
                    <% if (product.images && product.images.length > 0) { %>
                      <% 
                        // หารูปที่เป็นรูปหลัก
                        const featuredImage = product.images.find(img => img.isFeatured) || product.images[0];
                      %>
                      <img src="<%= featuredImage.url %>" alt="<%= product.name %>" class="tab-image" style="height: 150px; object-fit: contain;">
                    <% } else { %>
                      <div class="bg-light d-flex justify-content-center align-items-center py-4" style="height: 150px;">
                        <i class="bi bi-image fs-1 text-muted"></i>
                      </div>
                    <% } %>
                  </figure>
                  <div class="d-flex flex-column text-center p-3 pt-0">
                    <h3 class="fs-6 fw-normal text-dark product-title"><%= product.name %></h3>
                    <div class="d-flex justify-content-center align-items-center gap-2 mt-1">
                      <span class="text-dark fw-semibold"><%= product.price || 'ไม่ระบุราคา' %> ฿</span>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center gap-2 mt-2">
                      <small class="badge bg-success"><%= category.name %></small>
                      <small class="text-dark">
                        <i class="fa-solid fa-eye"></i> <%= product.fakeViews || 0 %>
                      </small>
                    </div>
                  </div>
                </a>
              </div>
            </div>
          <% }) %>
        </div>
      <% } else { %>
        <div class="col-12 text-center py-5">
          <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            ยังไม่มีสินค้าในหมวดหมู่นี้
          </div>
          <a href="/shop" class="btn btn-outline-primary mt-3">
            <i class="bi bi-arrow-left me-2"></i>
            กลับไปยังหมวดหมู่สินค้า
          </a>
        </div>
      <% } %>
    </div>
  </div>
  
  <div class="text-center mt-4 mb-5">
    <a href="/shop" class="btn btn-outline-primary">
      <i class="bi bi-arrow-left me-2"></i>
      กลับไปยังหมวดหมู่สินค้า
    </a>
  </div>
</div>

<style>
  .product-item {
    transition: all 0.3s ease;
    border: 1px solid #f0f0f0;
    height: 100%;
    display: flex;
    flex-direction: column;
  }
  
  .product-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
  }
  
  .product-item figure {
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .tab-image {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
  }
  
  .product-item a {
    display: flex;
    flex-direction: column;
    height: 100%;
    text-decoration: none;
    color: inherit;
  }
  
  .product-title {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    min-height: 3em;
  }
  
  .a {
    text-decoration: none;
    color: inherit;
  }
  
  /* Mobile Responsive Styles */
  @media (max-width: 576px) {
    .carousel-item img {
      height: 180px;
      object-fit: cover;
    }
    
    .product-grid {
      margin-left: -5px;
      margin-right: -5px;
    }
    
    .product-grid .col {
      padding-left: 5px;
      padding-right: 5px;
      margin-bottom: 10px;
    }
    
    .product-item {
      min-height: 250px;
    }
    
    .product-item figure {
      height: 120px;
      padding: 5px !important;
    }
    
    .tab-image {
      height: 100px !important;
    }
    
    .product-item .p-3 {
      padding: 0.5rem !important;
    }
    
    h1 {
      font-size: 1.5rem;
    }
    
    .fs-6 {
      font-size: 0.9rem !important;
    }
    
    .badge {
      font-size: 0.6rem;
    }
    
    .container {
      padding-left: 10px;
      padding-right: 10px;
    }
    
    .breadcrumb {
      font-size: 0.8rem;
    }
    
    .breadcrumb-item+.breadcrumb-item::before {
      padding-right: 0.3rem;
      padding-left: 0.3rem;
    }
  }
</style>